<!DOCTYPE html>
<html>
<head>
    <title>MinIO Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .file-item { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .delete-btn { background: #dc3545; }
        .delete-btn:hover { background: #c82333; }
    </style>
</head>
<body>
    <h1>MinIO Upload Test - DeenAI</h1>
    
    <div class="upload-area">
        <input type="file" id="fileInput" multiple>
        <br><br>
        <button onclick="uploadFiles()">Upload Files</button>
    </div>
    
    <div id="status"></div>
    <div id="fileList"></div>

    <script>
        const API_BASE = 'http://localhost:3001/files';
        let uploadedFiles = [];

        async function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            const status = document.getElementById('status');
            
            if (files.length === 0) {
                status.innerHTML = '<p style="color: red;">Please select files first</p>';
                return;
            }

            status.innerHTML = '<p>Uploading...</p>';

            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch(`${API_BASE}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    uploadedFiles.push(result);
                    status.innerHTML = '<p style="color: green;">Upload successful!</p>';
                } catch (error) {
                    status.innerHTML = `<p style="color: red;">Upload failed: ${error.message}</p>`;
                }
            }
            
            displayFiles();
            document.getElementById('fileInput').value = '';
        }

        async function deleteFile(fileName) {
            if (!confirm(`Are you sure you want to delete "${fileName}"?`)) {
                return;
            }
            
            try {
                await fetch(`${API_BASE}/${fileName}`, { method: 'DELETE' });
                uploadedFiles = uploadedFiles.filter(f => f.fileName !== fileName);
                displayFiles();
                alert('File deleted successfully!');
            } catch (error) {
                alert('Delete failed: ' + error.message);
            }
        }

        async function getFileUrl(fileName) {
            try {
                const response = await fetch(`${API_BASE}/${fileName}`);
                const result = await response.json();
                window.open(result.fileUrl, '_blank');
            } catch (error) {
                alert('Failed to get file URL: ' + error.message);
            }
        }

        async function loadExistingFiles() {
            try {
                const response = await fetch(`${API_BASE}`);
                const result = await response.json();
                uploadedFiles = result.files.map(fileName => ({ fileName }));
                displayFiles();
            } catch (error) {
                console.error('Failed to load files:', error);
            }
        }

        function displayFiles() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>Uploaded Files:</h3>';
            
            uploadedFiles.forEach(file => {
                fileList.innerHTML += `
                    <div class="file-item">
                        <strong>${file.fileName}</strong><br>
                        <button onclick="getFileUrl('${file.fileName}')">View</button>
                        <button class="delete-btn" onclick="deleteFile('${file.fileName}')">Delete</button>
                    </div>
                `;
            });
        }

        // Load existing files on page load
        window.onload = loadExistingFiles;
    </script>
</body>
</html>